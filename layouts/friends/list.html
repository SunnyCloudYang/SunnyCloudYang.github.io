{{- define "main" }}

{{- if (and site.Params.profileMode.enabled .IsHome) }}
{{- partial "index_profile.html" . }}
{{- else }} {{/* if not profileMode */}}

{{- if not .IsHome | and .Title }}
<header class="page-header">
    {{- partial "breadcrumbs.html" . }}
    <h1>
        {{ .Title | markdownify }}
        {{- if and (or (eq .Kind `term`) (eq .Kind `section`)) (.Param "ShowRssButtonInSectionTermList") }}
        <a href="index.xml" title="RSS" aria-label="RSS">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23">
                <path d="M4 11a9 9 0 0 1 9 9" />
                <path d="M4 4a16 16 0 0 1 16 16" />
                <circle cx="5" cy="19" r="1" />
            </svg>
        </a>
        {{- end }}
    </h1>
    {{- if .Description }}
    <div class="post-description">
        {{ .Description | markdownify }}
    </div>
    {{- end }}
</header>
{{- end }}

{{- if .Content }}
<div class="post-content">
    {{- if not (.Param "disableAnchoredHeadings") }}
    {{- partial "anchored_headings.html" .Content -}}
    {{- else }}{{ .Content }}{{ end }}
</div>
{{- end }}

<div class="friends">
    {{- $pages := union .RegularPages .Sections }}

    {{- if .IsHome }}
    {{- $pages = where site.RegularPages "Type" "in" site.Params.mainSections }}
    {{- $pages = where $pages "Params.hiddenInHomeList" "!=" "true" }}
    {{- end }}

    {{- $paginator := .Paginate $pages }}

    {{- if and .IsHome site.Params.homeInfoParams (eq $paginator.PageNumber 1) }}
    {{- partial "home_info.html" . }}
    {{- end }}

    {{- $term := .Data.Term }}
    {{- range $index, $page := $paginator.Pages }}

    {{- $class := "post-entry" }}

    {{- $user_preferred := or site.Params.disableSpecial1stPost site.Params.homeInfoParams }}
    {{- if (and $.IsHome (eq $paginator.PageNumber 1) (eq $index 0) (not $user_preferred)) }}
    {{- $class = "first-entry" }}
    {{- else if $term }}
    {{- $class = "post-entry tag-entry" }}
    {{- end }}

    {{/* <article class="{{ $class }}">
        <div class="post-info"> <!--custom-->
            <header class="entry-header">
                <h2>
                    {{- .Title }}
                </h2>
            </header>
            {{- if (ne (.Param "hideSummary") true) }}
            <section class="entry-content">
                <p>{{ .Summary | markdownify | htmlUnescape }}{{ if .Truncated }}...{{ end }}</p>
            </section>
            {{- end }}
        </div> <!--custom-->
        {{- $isHidden := (.Site.Params.cover.hidden | default .Site.Params.cover.hiddenInList) }}
        {{- partial "cover1.html" (dict "cxt" . "IsHome" true "isHidden" $isHidden) }}
        <a class="entry-link" aria-label="friend ship to {{ .Title | plainify }}" href="{{ .Page.Params.Permalink }}"
            target="_blank"></a>
    </article> */}}

    {{- $alt := (.Params.cover.alt | default .Params.cover.caption | plainify) }}
    <div class="friend-skeleton">
        <a href="{{ .Page.Params.Permalink }}" target="_blank">
            <div class="friend">
                <div class="friend-avatar-wrapper">
                    <img class="friend-avatar" src="{{ (.Params.cover.image) | absURL }}" alt="{{ $alt }}" />
                </div>
                <div class="friend-content">
                    <div class="friend-name">{{ .Title }}</div>
                    <div class="friend-description">{{ .Summary }}</div>
                </div>
            </div>
        </a>
    </div>

    {{- end }}

</div>
{{- if gt $paginator.TotalPages 1 }}
<footer class="page-footer">
    <nav class="pagination">
        {{- if $paginator.HasPrev }}
        <a class="prev" href="{{ $paginator.Prev.URL | absURL }}">
            «&nbsp;{{ i18n "prev_page" }}&nbsp;
            {{- if (.Param "ShowPageNums") }}
            {{- sub $paginator.PageNumber 1 }}/{{ $paginator.TotalPages }}
            {{- end }}
        </a>
        {{- end }}
        {{- if $paginator.HasNext }}
        <a class="next" href="{{ $paginator.Next.URL | absURL }}">
            {{- i18n "next_page" }}&nbsp;
            {{- if (.Param "ShowPageNums") }}
            {{- add 1 $paginator.PageNumber }}/{{ $paginator.TotalPages }}
            {{- end }}&nbsp;»
        </a>
        {{- end }}
    </nav>
</footer>
{{- end }}

{{- end }}{{/* end profileMode */}}

{{- end }}{{- /* end main */ -}}